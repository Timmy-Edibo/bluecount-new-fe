exports.id=0,exports.ids=[0],exports.modules={1135:()=>{},1172:(a,b,c)=>{"use strict";c.d(b,{AuthProvider:()=>e});var d=c(7954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call AuthProvider() from the server but AuthProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/timothyedibo/projects/personal/bluecounts/frontend/src/contexts/AuthContext.tsx","AuthProvider");(0,d.registerClientReference)(function(){throw Error("Attempted to call useAuth() from the server but useAuth is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/timothyedibo/projects/personal/bluecounts/frontend/src/contexts/AuthContext.tsx","useAuth"),(0,d.registerClientReference)(function(){throw Error("Attempted to call getAuthToken() from the server but getAuthToken is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/timothyedibo/projects/personal/bluecounts/frontend/src/contexts/AuthContext.tsx","getAuthToken")},1472:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>k,metadata:()=>i,viewport:()=>j});var d=c(5338),e=c(1172),f=c(3386),g=c(3916),h=c(9560);c(1135);let i={title:"Bluecounts POS",description:"Offline-First Multi-Tenant POS & Inventory",manifest:"/manifest.webmanifest"},j={themeColor:"#0f172a"};function k({children:a}){return(0,d.jsx)("html",{lang:"en",children:(0,d.jsxs)("body",{className:"antialiased",children:[(0,d.jsx)(g.PWARegister,{}),(0,d.jsx)(h.InstallPWA,{variant:"banner"}),(0,d.jsx)(e.AuthProvider,{children:(0,d.jsx)(f.SessionProvider,{children:a})})]})})}},3386:(a,b,c)=>{"use strict";c.d(b,{SessionProvider:()=>e});var d=c(7954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call SessionProvider() from the server but SessionProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/timothyedibo/projects/personal/bluecounts/frontend/src/contexts/SessionContext.tsx","SessionProvider");(0,d.registerClientReference)(function(){throw Error("Attempted to call useSession() from the server but useSession is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/timothyedibo/projects/personal/bluecounts/frontend/src/contexts/SessionContext.tsx","useSession")},3435:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,4160,23)),Promise.resolve().then(c.t.bind(c,1603,23)),Promise.resolve().then(c.t.bind(c,8495,23)),Promise.resolve().then(c.t.bind(c,5170,23)),Promise.resolve().then(c.t.bind(c,7526,23)),Promise.resolve().then(c.t.bind(c,8922,23)),Promise.resolve().then(c.t.bind(c,9234,23)),Promise.resolve().then(c.t.bind(c,2263,23)),Promise.resolve().then(c.bind(c,2146))},3558:(a,b,c)=>{Promise.resolve().then(c.bind(c,7518)),Promise.resolve().then(c.bind(c,8166)),Promise.resolve().then(c.bind(c,4342)),Promise.resolve().then(c.bind(c,9812))},3674:(a,b,c)=>{"use strict";c.d(b,{db:()=>f});var d=c(120);class e extends d.Ay{constructor(){super("BluecountsDB"),this.version(1).stores({products:"id, tenant_id, outlet_id, [tenant_id+outlet_id], [tenant_id+sku], version_id",inventory:"id, tenant_id, outlet_id, product_id, [tenant_id+outlet_id+product_id], version_id",sales:"id, tenant_id, outlet_id, device_id, [tenant_id+device_id+device_transaction_id], version_id, created_at",sale_items:"id, sale_id, tenant_id, outlet_id, product_id",sync_queue:"id, timestamp, status",sync_meta:"key"}),this.version(2).stores({products:"id, tenant_id, outlet_id, [tenant_id+outlet_id], [tenant_id+sku], version_id",inventory:"id, tenant_id, outlet_id, product_id, [tenant_id+outlet_id+product_id], version_id",sales:"id, tenant_id, outlet_id, device_id, session_id, [tenant_id+device_id+device_transaction_id], version_id, created_at",sale_items:"id, sale_id, tenant_id, outlet_id, product_id",pos_sessions:"id, tenant_id, outlet_id, user_id, [outlet_id+status], version_id, opened_at",sync_queue:"id, timestamp, status",sync_meta:"key"}),this.version(3).stores({products:"id, tenant_id, [tenant_id+sku], version_id",inventory:"id, tenant_id, outlet_id, product_id, [tenant_id+outlet_id+product_id], version_id",sales:"id, tenant_id, outlet_id, device_id, session_id, [tenant_id+device_id+device_transaction_id], version_id, created_at",sale_items:"id, sale_id, tenant_id, outlet_id, product_id",pos_sessions:"id, tenant_id, outlet_id, user_id, [outlet_id+status], version_id, opened_at",sync_queue:"id, timestamp, status",sync_meta:"key"})}}let f=new e},3916:(a,b,c)=>{"use strict";c.d(b,{PWARegister:()=>d});let d=(0,c(7954).registerClientReference)(function(){throw Error("Attempted to call PWARegister() from the server but PWARegister is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/timothyedibo/projects/personal/bluecounts/frontend/src/components/PWARegister.tsx","PWARegister")},4342:(a,b,c)=>{"use strict";c.d(b,{A:()=>k,AuthProvider:()=>j,c:()=>l});var d=c(1124),e=c(8301);let f=process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",g={user:null,tenant:null,role:"",outletId:null,token:null},h=(0,e.createContext)(null);function i(a){}function j({children:a}){let[b,c]=(0,e.useState)(g),j=(0,e.useCallback)(a=>{c(a)},[]),k=(0,e.useCallback)(async(a,b)=>{let c=await fetch(`${f}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:b})});if(!c.ok)throw Error((await c.json().catch(()=>({}))).error||"Login failed");let d=await c.json();j({user:d.user,tenant:d.tenant,role:d.role,outletId:d.outletId??null,token:d.token})},[j]),l=(0,e.useCallback)(async(a,b,c)=>{let d=await fetch(`${f}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:b,businessName:c})});if(!d.ok)throw Error((await d.json().catch(()=>({}))).error||"Registration failed");let e=await d.json();j({user:e.user,tenant:e.tenant,role:e.role,outletId:null,token:e.token})},[j]),m=(0,e.useCallback)(()=>{j(g)},[j]),n=(0,e.useCallback)(a=>{c(b=>{let c={...b,outletId:a};return i(c),c})},[]);return(0,d.jsx)(h.Provider,{value:{...b,login:k,register:l,logout:m,setOutletId:n,setAuth:j},children:a})}function k(){let a=(0,e.useContext)(h);if(!a)throw Error("useAuth must be used within AuthProvider");return a}function l(){return null}},5102:(a,b,c)=>{Promise.resolve().then(c.bind(c,9560)),Promise.resolve().then(c.bind(c,3916)),Promise.resolve().then(c.bind(c,1172)),Promise.resolve().then(c.bind(c,3386))},7518:(a,b,c)=>{"use strict";c.d(b,{InstallPWA:()=>f});var d=c(1124),e=c(8301);function f({variant:a="sidebar"}){let[b,c]=(0,e.useState)(null),[f,g]=(0,e.useState)(!1),[h,i]=(0,e.useState)(!1),[j,k]=(0,e.useState)(!1),l=async()=>{if(!b)return;await b.prompt();let{outcome:a}=await b.userChoice;"accepted"===a&&c(null)},m=()=>{i(!0),"undefined"!=typeof sessionStorage&&sessionStorage.setItem("pwa-install-dismissed","1")};if(f||h||!b&&!j)return null;let n="banner"===a;return(0,d.jsx)("div",{className:n?"fixed bottom-0 left-0 right-0 z-50 flex items-center justify-between gap-4 border-t border-slate-600 bg-slate-800 px-4 py-3 shadow-lg":"border-t border-slate-700 p-3 space-y-2",children:b?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{className:n?"text-slate-300 text-sm":"text-slate-400 text-xs",children:"Install Bluecounts for offline use"}),(0,d.jsxs)("div",{className:"flex gap-2 shrink-0",children:[(0,d.jsx)("button",{type:"button",onClick:l,className:"rounded-lg bg-sky-600 px-4 py-2 text-sm font-medium text-white hover:bg-sky-500",children:"Install app"}),(0,d.jsx)("button",{type:"button",onClick:m,className:"rounded-lg px-3 py-2 text-sm text-slate-500 hover:text-slate-300","aria-label":"Dismiss",children:"Not now"})]})]}):j?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("p",{className:n?"text-slate-300 text-sm":"text-slate-400 text-xs",children:["Install: tap Share ",(0,d.jsx)("span",{"aria-hidden":!0,children:"âŽ‹"}),' then "Add to Home Screen"']}),(0,d.jsx)("button",{type:"button",onClick:m,className:"shrink-0 text-slate-500 hover:text-slate-300 text-sm",children:"Dismiss"})]}):null})}},8166:(a,b,c)=>{"use strict";function d(){return null}c.d(b,{PWARegister:()=>d}),c(8301)},9011:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,1170,23)),Promise.resolve().then(c.t.bind(c,3597,23)),Promise.resolve().then(c.t.bind(c,6893,23)),Promise.resolve().then(c.t.bind(c,9748,23)),Promise.resolve().then(c.t.bind(c,6060,23)),Promise.resolve().then(c.t.bind(c,7184,23)),Promise.resolve().then(c.t.bind(c,9576,23)),Promise.resolve().then(c.t.bind(c,3041,23)),Promise.resolve().then(c.t.bind(c,1384,23))},9560:(a,b,c)=>{"use strict";c.d(b,{InstallPWA:()=>d});let d=(0,c(7954).registerClientReference)(function(){throw Error("Attempted to call InstallPWA() from the server but InstallPWA is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/timothyedibo/projects/personal/bluecounts/frontend/src/components/InstallPWA.tsx","InstallPWA")},9812:(a,b,c)=>{"use strict";c.d(b,{SessionProvider:()=>j,w:()=>k});var d=c(1124),e=c(8301),f=c(3674),g=c(4342);let h=process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001",i=(0,e.createContext)(null);function j({children:a}){let b=(0,g.A)(),[c,j]=(0,e.useState)(null),[k,l]=(0,e.useState)(!0),m=b.tenant?.id??"",n=b.outletId??"",o=b.user?.id??"",p=(0,e.useCallback)(async()=>{if(!m||!n){j(null),l(!1);return}l(!0);try{let a=(0,g.c)();if(a){let b=await fetch(`${h}/sessions?outlet_id=${encodeURIComponent(n)}&status=open`,{headers:{Authorization:`Bearer ${a}`}});if(b.ok){let a=await b.json(),c=a.sessions?.find(a=>"open"===a.status);if(c){j({id:c.id,openingBalance:c.opening_balance,outletId:c.outlet_id}),l(!1);return}}}let b=await f.db.pos_sessions.where("[outlet_id+status]").equals([n,"open"]).first();b?j({id:b.id,openingBalance:b.opening_balance,outletId:b.outlet_id}):j(null)}catch{let a=await f.db.pos_sessions.where("[outlet_id+status]").equals([n,"open"]).first();a?j({id:a.id,openingBalance:a.opening_balance,outletId:a.outlet_id}):j(null)}finally{l(!1)}},[m,n]),q=(0,e.useCallback)(async(a,b,c)=>{let d=c||"",e=(0,g.c)(),i=crypto.randomUUID(),k=new Date().toISOString();if(e)try{let c=await fetch(`${h}/sessions/open`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({outlet_id:a,device_id:d||void 0,opening_balance:b})});if(c.ok){let e=await c.json(),g=e.session_id;j({id:g,openingBalance:e.opening_balance??b,outletId:a}),await f.db.pos_sessions.put({id:g,tenant_id:m,outlet_id:a,user_id:o,device_id:d||null,opening_balance:e.opening_balance??b,status:"open",opened_at:new Date().toISOString(),version_id:e.version_id??0});return}}catch{}await f.db.sync_queue.add({id:crypto.randomUUID(),action_type:"OPEN_SESSION",payload:{id:i,outlet_id:a,device_id:d||void 0,opening_balance:b,opened_at:k,user_id:o},timestamp:Date.now(),status:"pending"}),await f.db.pos_sessions.put({id:i,tenant_id:m,outlet_id:a,user_id:o,device_id:d||null,opening_balance:b,status:"open",opened_at:k,version_id:0}),j({id:i,openingBalance:b,outletId:a})},[m,o,""]),r=(0,e.useCallback)(async(a,b)=>{let c=(0,g.c)(),d=new Date().toISOString();if(c)try{let e=await fetch(`${h}/sessions/${a}/close`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({closing_balance:b})});if(e.ok){let c=await e.json();return await f.db.pos_sessions.update(a,{closing_balance:b,expected_balance:c.expected_balance??null,status:"closed",closed_at:d,version_id:c.version_id??0}),j(null),{variance:c.variance??0}}}catch{}await f.db.sync_queue.add({id:crypto.randomUUID(),action_type:"CLOSE_SESSION",payload:{session_id:a,closing_balance:b,closed_at:d},timestamp:Date.now(),status:"pending"});let e=await f.db.pos_sessions.get(a),i=(await f.db.sales.where("session_id").equals(a).toArray()).reduce((a,b)=>a+b.total_amount,0),k=(e?.opening_balance??0)+i;return await f.db.pos_sessions.update(a,{closing_balance:b,expected_balance:k,status:"closed",closed_at:d}),j(null),{variance:b-k}},[]);return(0,d.jsx)(i.Provider,{value:{currentSession:c,loading:k,openSession:q,closeSession:r,refreshSession:p},children:a})}function k(){let a=(0,e.useContext)(i);if(!a)throw Error("useSession must be used within SessionProvider");return a}}};