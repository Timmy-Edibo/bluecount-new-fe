exports.id=427,exports.ids=[427],exports.modules={46:(a,b,c)=>{Promise.resolve().then(c.bind(c,7788))},214:(a,b,c)=>{Promise.resolve().then(c.bind(c,7668))},7370:(a,b,c)=>{"use strict";c.d(b,{a:()=>j});var d=c(8301),e=c(3674),f=c(4342);let g="local_max_version_id",h=process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001";function i(){let a=(0,f.c)(),b={"Content-Type":"application/json"};return a&&(b.Authorization=`Bearer ${a}`),b}function j({tenantId:a,outletId:b,deviceId:c,enabled:f=!0}){let[j,k]=(0,d.useState)(()=>!1),[l,m]=(0,d.useState)(!0),n=(0,d.useCallback)(a=>{},[]),[o,p]=(0,d.useState)("idle"),[q,r]=(0,d.useState)(null),[s,t]=(0,d.useState)(0),u=(0,d.useCallback)(async()=>{let a=await e.db.sync_meta.get(g),b=a?.value;return"number"==typeof b?b:"string"==typeof b&&parseInt(b,10)||0},[]),v=(0,d.useCallback)(async a=>{await e.db.sync_meta.put({key:g,value:a})},[]),w=(0,d.useCallback)(async(b=!1)=>{if(a){p("pulling"),r(null);try{let c=await u();if(b)c=0;else{let b=await e.db.products.where("tenant_id").equals(a).count();0===b&&(c=0)}let d=`${h}/sync/pull?tenant_id=${encodeURIComponent(a)}&max_version_id=${c}`,f=await fetch(d,{headers:i()});if(!f.ok)throw Error(`Pull failed: ${f.status}`);let{tables:g,server_max_version_id:j}=await f.json();if(g.products?.length)for(let a of g.products)a.deleted_at?await e.db.products.update(a.id,{deleted_at:a.deleted_at,version_id:a.version_id}):await e.db.products.put({id:a.id,tenant_id:a.tenant_id,sku:a.sku,name:a.name,description:a.description??null,price:Number(a.price),version_id:a.version_id,created_at:a.created_at,updated_at:a.updated_at,deleted_at:a.deleted_at??null});if(g.inventory?.length)for(let a of g.inventory){let b=[a.tenant_id,a.outlet_id,a.product_id];for(let c of(await e.db.inventory.where("[tenant_id+outlet_id+product_id]").equals(b).toArray()))c.id!==a.id&&await e.db.inventory.delete(c.id);a.deleted_at?await e.db.inventory.update(a.id,{deleted_at:a.deleted_at,version_id:a.version_id}):await e.db.inventory.put({id:a.id,tenant_id:a.tenant_id,outlet_id:a.outlet_id,product_id:a.product_id,quantity:Number(a.quantity),version_id:a.version_id,created_at:a.created_at,updated_at:a.updated_at,deleted_at:a.deleted_at??null})}if(g.sales?.length)for(let a of g.sales)a.deleted_at?await e.db.sales.update(a.id,{deleted_at:a.deleted_at,version_id:a.version_id}):await e.db.sales.put({id:a.id,tenant_id:a.tenant_id,outlet_id:a.outlet_id,device_id:a.device_id,session_id:a.session_id??null,device_transaction_id:a.device_transaction_id,total_amount:Number(a.total_amount),version_id:a.version_id,created_at:a.created_at,updated_at:a.updated_at,deleted_at:a.deleted_at??null});if(g.sale_items?.length)for(let a of g.sale_items)a.deleted_at?await e.db.sale_items.update(a.id,{deleted_at:a.deleted_at,version_id:a.version_id}):await e.db.sale_items.put({id:a.id,tenant_id:a.tenant_id,outlet_id:a.outlet_id,sale_id:a.sale_id,product_id:a.product_id,quantity:a.quantity,unit_price:Number(a.unit_price),line_total:Number(a.line_total),version_id:a.version_id,created_at:a.created_at,deleted_at:a.deleted_at??null});if(g.pos_sessions?.length)for(let a of g.pos_sessions)a.deleted_at?await e.db.pos_sessions.update(a.id,{deleted_at:a.deleted_at,version_id:a.version_id}):await e.db.pos_sessions.put({id:a.id,tenant_id:a.tenant_id,outlet_id:a.outlet_id,user_id:a.user_id,device_id:a.device_id??null,opening_balance:Number(a.opening_balance),closing_balance:null!=a.closing_balance?Number(a.closing_balance):null,expected_balance:null!=a.expected_balance?Number(a.expected_balance):null,status:"closed"===a.status?"closed":"open",opened_at:a.opened_at,closed_at:a.closed_at??null,version_id:a.version_id,deleted_at:a.deleted_at??null});"number"==typeof j&&await v(j)}catch(a){r(a instanceof Error?a.message:"Pull failed"),p("error");return}p("idle")}},[a,b,u,v]),x=(0,d.useCallback)(async()=>{if(!a||!b||!c)return;let d=await e.db.sync_queue.where("status").equals("pending").toArray();if(0===d.length)return void t(0);p("pushing"),r(null);try{let f=d.map(a=>({id:a.id,action_type:a.action_type,payload:a.payload})),g=await fetch(`${h}/sync`,{method:"POST",headers:i(),body:JSON.stringify({tenant_id:a,outlet_id:b,device_id:c,items:f})});if(!g.ok){let a=await g.text();throw Error(a||`Push failed: ${g.status}`)}let j=await g.json();for(let a of(null!=j.version_id&&await v(j.version_id),j.results||[]))"accepted"===a.status||"synced"===a.status?await e.db.sync_queue.update(a.queue_id,{status:"synced"}):"failed"===a.status&&await e.db.sync_queue.update(a.queue_id,{status:"failed",error_message:a.error});let k=await e.db.sync_queue.where("status").equals("pending").count();t(k)}catch(a){r(a instanceof Error?a.message:"Push failed"),p("error");return}p("idle"),t(await e.db.sync_queue.where("status").equals("pending").count())},[a,b,c,v]);return{isOnline:l&&!j,syncState:o,lastError:q,pendingCount:s,sync:(0,d.useCallback)(async()=>{f&&(await w(!0),await x(),await w(!0))},[f,w,x]),pull:w,push:x,simulateOffline:j,setSimulateOffline:n}}},7668:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>n});var d=c(1124),e=c(8301),f=c(3991),g=c.n(f),h=c(2378),i=c(4342),j=c(9812),k=c(7370);function l({onCloseSession:a}){let b=(0,h.usePathname)(),c=(0,i.A)(),f=(0,j.w)(),[l,m]=(0,e.useState)([]),n=c.tenant?.id??"",o=c.outletId??"",{isOnline:p,syncState:q,lastError:r,pendingCount:s,sync:t,simulateOffline:u,setSimulateOffline:v}=(0,k.a)({tenantId:n,outletId:o,deviceId:"",enabled:!!n&&!!o}),w=a=>`block w-full rounded-lg px-3 py-2 text-sm font-medium transition-colors ${b===a?"bg-slate-600 text-slate-100":"text-slate-400 hover:bg-slate-700/50 hover:text-slate-200"}`;return c.token?(0,d.jsxs)("aside",{className:"w-60 shrink-0 border-r border-slate-700 bg-slate-800/50 flex flex-col min-h-screen",children:[(0,d.jsxs)("div",{className:"p-4 border-b border-slate-700",children:[(0,d.jsx)(g(),{href:"/",className:"text-lg font-bold text-slate-100",children:"Bluecounts"}),c.tenant&&(0,d.jsx)("p",{className:"text-slate-500 text-xs mt-1 truncate",children:c.tenant.name})]}),(0,d.jsxs)("div",{className:"p-3 space-y-2 border-b border-slate-700",children:[c.user&&(0,d.jsx)("p",{className:"text-slate-400 text-sm truncate px-2",title:c.user.email,children:c.user.name||c.user.email}),l.length>0&&(0,d.jsxs)("select",{className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200 text-sm",value:c.outletId??"",onChange:a=>c.setOutletId(a.target.value||null),"aria-label":"Change outlet",children:[(0,d.jsx)("option",{value:"",children:"Select outlet"}),l.map(a=>(0,d.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,d.jsxs)("nav",{className:"p-3 flex-1 flex flex-col gap-0.5",children:[(0,d.jsx)(g(),{href:"/",className:w("/"),children:"POS"}),(0,d.jsx)(g(),{href:"/inventory",className:w("/inventory"),children:"Inventory"}),("OWNER"===c.role||"ADMIN"===c.role)&&(0,d.jsx)(g(),{href:"/staff",className:w("/staff"),children:"Staff"}),f.currentSession&&a&&(0,d.jsx)("button",{type:"button",onClick:a,className:"w-full text-left rounded-lg px-3 py-2 text-sm font-medium text-amber-400 hover:bg-amber-500/10 transition-colors",children:"Close Session"})]}),(0,d.jsxs)("div",{className:"p-3 border-t border-slate-700 space-y-2",children:[(0,d.jsxs)("span",{className:`inline-flex items-center gap-2 rounded-full px-2 py-1 text-xs font-medium ${p?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,children:[(0,d.jsx)("span",{className:`h-1.5 w-1.5 rounded-full ${p?"bg-emerald-400":"bg-amber-400"}`}),p?"Online":"Offline"]}),s>0&&(0,d.jsxs)("span",{className:"block text-xs text-sky-400",children:[s," pending"]}),"idle"!==q&&(0,d.jsx)("span",{className:"block text-xs text-slate-400",children:"pulling"===q?"Pulling…":"pushing"===q?"Pushing…":"Syncing…"}),(0,d.jsx)("button",{type:"button",onClick:t,disabled:!p||"pulling"===q||"pushing"===q,className:"w-full rounded-lg bg-slate-600 py-2 text-sm font-medium text-white hover:bg-slate-500 disabled:opacity-50",children:"Sync now"}),!1,r&&(0,d.jsx)("p",{className:"text-xs text-red-400 truncate",title:r,children:"Sync error"}),(0,d.jsx)("button",{type:"button",onClick:()=>c.logout(),className:"w-full text-left rounded-lg px-3 py-2 text-sm text-slate-400 hover:bg-slate-700/50 hover:text-slate-200",children:"Sign out"})]})]}):(0,d.jsxs)("aside",{className:"w-56 shrink-0 border-r border-slate-700 bg-slate-800/50 flex flex-col",children:[(0,d.jsx)("div",{className:"p-4 border-b border-slate-700",children:(0,d.jsx)(g(),{href:"/",className:"text-lg font-bold text-slate-100",children:"Bluecounts"})}),(0,d.jsx)("nav",{className:"p-3 flex-1",children:(0,d.jsx)(g(),{href:"/login",className:"text-sky-400 hover:text-sky-300 text-sm font-medium",children:"Sign in"})})]})}function m({sessionId:a,openingBalance:b,onClose:c,onDismiss:f}){let[g,h]=(0,e.useState)(""),[i,j]=(0,e.useState)(b),[k,l]=(0,e.useState)(null),[m,n]=(0,e.useState)(null),[o,p]=(0,e.useState)(!1),[q,r]=(0,e.useState)(!1),s=async a=>{a.preventDefault(),n(null);let b=parseFloat(g);if(Number.isNaN(b)||b<0)return void n("Enter a valid closing balance (0 or more).");p(!0);try{let a=await c(b);a?.variance!=null&&l(a.variance),r(!0)}catch(a){n(a instanceof Error?a.message:"Failed to close session")}finally{p(!1)}};return q?(0,d.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,d.jsxs)("div",{className:"rounded-xl bg-slate-800 border border-slate-700 p-6 max-w-sm w-full",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Session closed"}),null!=k&&(0,d.jsxs)("p",{className:`text-sm mb-4 ${0===k?"text-slate-400":"text-amber-400"}`,children:["Variance: ",k>=0?"+":"",k.toFixed(2)]}),(0,d.jsx)("button",{type:"button",onClick:f,className:"w-full rounded-lg bg-slate-600 px-4 py-2 text-sm font-medium text-white hover:bg-slate-500",children:"Done"})]})}):(0,d.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,d.jsxs)("div",{className:"rounded-xl bg-slate-800 border border-slate-700 p-6 max-w-sm w-full",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold text-slate-200 mb-4",children:"Close Session"}),(0,d.jsxs)("p",{className:"text-slate-400 text-sm mb-2",children:["Opening balance: $",b.toFixed(2)]}),(0,d.jsxs)("p",{className:"text-slate-400 text-sm mb-4",children:["Expected (opening + sales): $",i.toFixed(2)]}),(0,d.jsxs)("form",{onSubmit:s,className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"closing_balance",className:"block text-sm font-medium text-slate-300 mb-1",children:"Actual cash count *"}),(0,d.jsx)("input",{id:"closing_balance",type:"number",step:"0.01",min:"0",value:g,onChange:a=>h(a.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200",placeholder:"0.00",required:!0})]}),m&&(0,d.jsx)("p",{className:"text-sm text-red-400",children:m}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{type:"button",onClick:f,className:"flex-1 rounded-lg bg-slate-600 px-4 py-2 text-sm font-medium text-white hover:bg-slate-500",children:"Cancel"}),(0,d.jsx)("button",{type:"submit",disabled:o,className:"flex-1 rounded-lg bg-amber-600 px-4 py-2 text-sm font-medium text-white hover:bg-amber-500 disabled:opacity-50",children:o?"Closing…":"Close Session"})]})]})]})})}function n({children:a}){let[b,c]=(0,e.useState)(!1),f=(0,j.w)();return(0,d.jsxs)("div",{className:"flex min-h-screen",children:[(0,d.jsx)(l,{onCloseSession:()=>c(!0)}),(0,d.jsx)("main",{className:"flex-1 min-w-0 p-4 md:p-6",children:a}),b&&f.currentSession&&(0,d.jsx)(m,{sessionId:f.currentSession.id,openingBalance:f.currentSession.openingBalance,onClose:a=>f.closeSession(f.currentSession.id,a),onDismiss:()=>c(!1)})]})}process.env.NEXT_PUBLIC_API_URL,c(3674)},7788:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(7954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/timothyedibo/projects/personal/bluecounts/frontend/src/app/(dashboard)/layout.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/timothyedibo/projects/personal/bluecounts/frontend/src/app/(dashboard)/layout.tsx","default")}};