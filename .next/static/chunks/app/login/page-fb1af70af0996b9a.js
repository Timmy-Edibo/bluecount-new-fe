(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{17:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>i});var n=l(5155),a=l(2115),r=l(63),s=l(2619),u=l.n(s),o=l(5380);function i(){let e=(0,r.useRouter)(),{login:t}=(0,o.A)(),[l,s]=(0,a.useState)(""),[i,c]=(0,a.useState)(""),[d,h]=(0,a.useState)(""),[m,f]=(0,a.useState)(!1);async function b(n){n.preventDefault(),h(""),f(!0);try{await t(l,i),e.push("/")}catch(e){h(e instanceof Error?e.message:"Login failed")}finally{f(!1)}}return(0,n.jsx)("main",{className:"min-h-screen flex items-center justify-center p-4 bg-slate-900",children:(0,n.jsxs)("div",{className:"w-full max-w-sm rounded-xl bg-slate-800 border border-slate-700 p-6",children:[(0,n.jsx)("h1",{className:"text-xl font-bold text-slate-100 mb-4",children:"Sign in"}),(0,n.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Email"}),(0,n.jsx)("input",{type:"email",value:l,onChange:e=>s(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-100",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Password"}),(0,n.jsx)("input",{type:"password",value:i,onChange:e=>c(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-100",required:!0})]}),d&&(0,n.jsx)("p",{className:"text-sm text-red-400",children:d}),(0,n.jsx)("button",{type:"submit",disabled:m,className:"w-full rounded-lg bg-sky-600 px-4 py-2 text-white font-medium hover:bg-sky-500 disabled:opacity-50",children:m?"Signing inâ€¦":"Sign in"})]}),(0,n.jsxs)("p",{className:"mt-4 text-sm text-slate-500",children:["No account? ",(0,n.jsx)(u(),{href:"/register",className:"text-sky-400 hover:underline",children:"Register a business"})]})]})})}},63:(e,t,l)=>{"use strict";var n=l(7260);l.o(n,"usePathname")&&l.d(t,{usePathname:function(){return n.usePathname}}),l.o(n,"useRouter")&&l.d(t,{useRouter:function(){return n.useRouter}}),l.o(n,"useSearchParams")&&l.d(t,{useSearchParams:function(){return n.useSearchParams}})},4633:(e,t,l)=>{Promise.resolve().then(l.bind(l,17))},5380:(e,t,l)=>{"use strict";l.d(t,{A:()=>d,AuthProvider:()=>c,c:()=>h});var n=l(5155),a=l(2115);let r=l(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3001",s="bluecounts_auth",u={user:null,tenant:null,role:"",outletId:null,token:null},o=(0,a.createContext)(null);function i(e){e.token&&e.tenant?localStorage.setItem(s,JSON.stringify(e)):localStorage.removeItem(s)}function c(e){let{children:t}=e,[l,c]=(0,a.useState)(u);(0,a.useEffect)(()=>{c(function(){try{var e,t,l,n,a;let r=localStorage.getItem(s);if(!r)return u;let o=JSON.parse(r);if((null==o?void 0:o.token)&&(null==o||null==(e=o.tenant)?void 0:e.id))return{user:null!=(t=o.user)?t:null,tenant:null!=(l=o.tenant)?l:null,role:null!=(n=o.role)?n:"",outletId:null!=(a=o.outletId)?a:null,token:o.token}}catch(e){}return u}())},[]);let d=(0,a.useCallback)(e=>{c(e),i(e)},[]),h=(0,a.useCallback)(async(e,t)=>{var l;let n=await fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!n.ok)throw Error((await n.json().catch(()=>({}))).error||"Login failed");let a=await n.json();d({user:a.user,tenant:a.tenant,role:a.role,outletId:null!=(l=a.outletId)?l:null,token:a.token})},[d]),m=(0,a.useCallback)(async(e,t,l)=>{let n=await fetch("".concat(r,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,businessName:l})});if(!n.ok)throw Error((await n.json().catch(()=>({}))).error||"Registration failed");let a=await n.json();d({user:a.user,tenant:a.tenant,role:a.role,outletId:null,token:a.token})},[d]),f=(0,a.useCallback)(()=>{d(u)},[d]),b=(0,a.useCallback)(e=>{c(t=>{let l={...t,outletId:e};return i(l),l})},[]);return(0,n.jsx)(o.Provider,{value:{...l,login:h,register:m,logout:f,setOutletId:b,setAuth:d},children:t})}function d(){let e=(0,a.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}function h(){try{var e;let t=localStorage.getItem(s);if(!t)return null;let l=JSON.parse(t);return null!=(e=null==l?void 0:l.token)?e:null}catch(e){return null}}}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=4633)),_N_E=e.O()}]);