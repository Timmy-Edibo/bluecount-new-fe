(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{63:(e,t,n)=>{"use strict";var l=n(7260);n.o(l,"usePathname")&&n.d(t,{usePathname:function(){return l.usePathname}}),n.o(l,"useRouter")&&n.d(t,{useRouter:function(){return l.useRouter}}),n.o(l,"useSearchParams")&&n.d(t,{useSearchParams:function(){return l.useSearchParams}})},5380:(e,t,n)=>{"use strict";n.d(t,{A:()=>d,AuthProvider:()=>c,c:()=>h});var l=n(5155),a=n(2115);let s=n(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3001",r="bluecounts_auth",o={user:null,tenant:null,role:"",outletId:null,token:null},u=(0,a.createContext)(null);function i(e){e.token&&e.tenant?localStorage.setItem(r,JSON.stringify(e)):localStorage.removeItem(r)}function c(e){let{children:t}=e,[n,c]=(0,a.useState)(o);(0,a.useEffect)(()=>{c(function(){try{var e,t,n,l,a;let s=localStorage.getItem(r);if(!s)return o;let u=JSON.parse(s);if((null==u?void 0:u.token)&&(null==u||null==(e=u.tenant)?void 0:e.id))return{user:null!=(t=u.user)?t:null,tenant:null!=(n=u.tenant)?n:null,role:null!=(l=u.role)?l:"",outletId:null!=(a=u.outletId)?a:null,token:u.token}}catch(e){}return o}())},[]);let d=(0,a.useCallback)(e=>{c(e),i(e)},[]),h=(0,a.useCallback)(async(e,t)=>{var n;let l=await fetch("".concat(s,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!l.ok)throw Error((await l.json().catch(()=>({}))).error||"Login failed");let a=await l.json();d({user:a.user,tenant:a.tenant,role:a.role,outletId:null!=(n=a.outletId)?n:null,token:a.token})},[d]),m=(0,a.useCallback)(async(e,t,n)=>{let l=await fetch("".concat(s,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,businessName:n})});if(!l.ok)throw Error((await l.json().catch(()=>({}))).error||"Registration failed");let a=await l.json();d({user:a.user,tenant:a.tenant,role:a.role,outletId:null,token:a.token})},[d]),x=(0,a.useCallback)(()=>{d(o)},[d]),f=(0,a.useCallback)(e=>{c(t=>{let n={...t,outletId:e};return i(n),n})},[]);return(0,l.jsx)(u.Provider,{value:{...n,login:h,register:m,logout:x,setOutletId:f,setAuth:d},children:t})}function d(){let e=(0,a.useContext)(u);if(!e)throw Error("useAuth must be used within AuthProvider");return e}function h(){try{var e;let t=localStorage.getItem(r);if(!t)return null;let n=JSON.parse(t);return null!=(e=null==n?void 0:n.token)?e:null}catch(e){return null}}},8800:(e,t,n)=>{Promise.resolve().then(n.bind(n,9858))},9858:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var l=n(5155),a=n(2115),s=n(63),r=n(2619),o=n.n(r),u=n(5380);let i=n(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3001";function c(){var e;let t=(0,s.useRouter)(),n=(0,s.useSearchParams)(),{setAuth:r}=(0,u.A)(),c=null!=(e=n.get("token"))?e:"",[d,h]=(0,a.useState)(""),[m,x]=(0,a.useState)(""),[f,b]=(0,a.useState)(""),[p,g]=(0,a.useState)(!1);async function v(e){if(e.preventDefault(),c){b(""),g(!0);try{var n;let e=await fetch("".concat(i,"/auth/accept-invite"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:c,password:d,name:m.trim()||void 0})}),l=await e.json().catch(()=>({}));if(!e.ok)throw Error(l.error||"Accept failed");r({user:l.user,tenant:l.tenant,role:l.role,outletId:null!=(n=l.outletId)?n:null,token:l.token}),t.push("/")}catch(e){b(e instanceof Error?e.message:"Something went wrong")}finally{g(!1)}}}return c?(0,l.jsxs)("div",{className:"w-full max-w-sm rounded-xl bg-slate-800 border border-slate-700 p-6",children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-slate-100 mb-4",children:"Accept invitation"}),(0,l.jsx)("p",{className:"text-slate-400 text-sm mb-4",children:"Set a password to join the business. You’ll be signed in after."}),(0,l.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Password *"}),(0,l.jsx)("input",{type:"password",value:d,onChange:e=>h(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-100",required:!0,minLength:6})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Name (optional)"}),(0,l.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),placeholder:"Your name",className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-100 placeholder:text-slate-500"})]}),f&&(0,l.jsx)("p",{className:"text-sm text-red-400",children:f}),(0,l.jsx)("button",{type:"submit",disabled:p,className:"w-full rounded-lg bg-sky-600 px-4 py-2 text-white font-medium hover:bg-sky-500 disabled:opacity-50",children:p?"Joining…":"Join and sign in"})]}),(0,l.jsxs)("p",{className:"mt-4 text-sm text-slate-500",children:[(0,l.jsx)(o(),{href:"/login",className:"text-sky-400 hover:underline",children:"Sign in"})," if you already have an account"]})]}):(0,l.jsxs)("div",{className:"w-full max-w-sm rounded-xl bg-slate-800 border border-slate-700 p-6",children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-slate-100 mb-4",children:"Accept invitation"}),(0,l.jsx)("p",{className:"text-slate-400 text-sm mb-4",children:"This invite link is invalid or missing. Ask your admin to send a new one."}),(0,l.jsx)(o(),{href:"/login",className:"text-sky-400 hover:underline text-sm",children:"Go to sign in"})]})}function d(){return(0,l.jsx)("main",{className:"min-h-screen flex items-center justify-center p-4 bg-slate-900",children:(0,l.jsx)(a.Suspense,{fallback:(0,l.jsx)("div",{className:"text-slate-400",children:"Loading…"}),children:(0,l.jsx)(c,{})})})}}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=8800)),_N_E=e.O()}]);