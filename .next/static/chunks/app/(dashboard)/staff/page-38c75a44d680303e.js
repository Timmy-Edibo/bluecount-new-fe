(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{2206:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var l=a(5155),s=a(2115),r=a(2619),n=a.n(r),o=a(5380);let i=a(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3001";function d(){let e=(0,o.A)(),[t,a]=(0,s.useState)([]),[r,d]=(0,s.useState)([]),[c,u]=(0,s.useState)([]),[m,x]=(0,s.useState)({}),[h,b]=(0,s.useState)(null),[p,f]=(0,s.useState)(null),[g,j]=(0,s.useState)(null),[v,N]=(0,s.useState)(null),[y,w]=(0,s.useState)(""),[k,A]=(0,s.useState)("CASHIER"),[S,C]=(0,s.useState)(""),[E,O]=(0,s.useState)(!1),[I,R]=(0,s.useState)(""),[M,_]=(0,s.useState)(""),[P,T]=(0,s.useState)(""),[q,F]=(0,s.useState)("CASHIER"),[D,G]=(0,s.useState)(""),[J,B]=(0,s.useState)(!1),[L,z]=(0,s.useState)(null),[H,U]=(0,s.useState)(""),[W,X]=(0,s.useState)(""),[Y,K]=(0,s.useState)(!1),[Q,V]=(0,s.useState)(null),Z="OWNER"===e.role||"ADMIN"===e.role,$=(0,s.useCallback)(async()=>{if(!e.token||!Z)return;let t={Authorization:"Bearer ".concat(e.token)};try{var l,s,r;let[e,n,o]=await Promise.all([fetch("".concat(i,"/staff/members"),{headers:t}),fetch("".concat(i,"/staff/invitations"),{headers:t}),fetch("".concat(i,"/outlets"),{headers:t})]);if(e.ok){let t=await e.json();a(null!=(l=t.members)?l:[])}if(n.ok){let e=await n.json();d(null!=(s=e.invitations)?s:[])}if(o.ok){let e=null!=(r=(await o.json()).outlets)?r:[];u(e);let a={};await Promise.all(e.map(async e=>{let l=await fetch("".concat(i,"/outlets/").concat(e.id,"/access"),{headers:t});if(l.ok){var s;let t=await l.json();a[e.id]=null!=(s=t.access)?s:[]}else a[e.id]=[]})),x(a)}}catch(e){f(e instanceof Error?e.message:"Failed to load")}},[e.token,Z]);(0,s.useEffect)(()=>{$()},[$]);let ee=(0,s.useCallback)(async(t,a)=>{if(e.token){b("".concat(t,"-").concat(a)),f(null);try{let l=await fetch("".concat(i,"/outlets/").concat(t,"/access"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)},body:JSON.stringify({user_id:a})});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||"Assign failed")}await $()}catch(e){f(e instanceof Error?e.message:"Assign failed")}finally{b(null)}}},[e.token,$]),et=(0,s.useCallback)(async(t,a)=>{if(e.token){b("".concat(t,"-").concat(a)),f(null);try{let l=await fetch("".concat(i,"/outlets/").concat(t,"/access/").concat(a),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e.token)}});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||"Remove failed")}await $()}catch(e){f(e instanceof Error?e.message:"Remove failed")}finally{b(null)}}},[e.token,$]),ea=(0,s.useCallback)(async t=>{t.preventDefault(),f(null),j(null);let a=y.trim().toLowerCase();if(!a)return void f("Email is required.");if("MANAGER"===k&&!S)return void f("Outlet is required for Manager role.");O(!0);try{let t=await fetch("".concat(i,"/auth/invite"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)},body:JSON.stringify({email:a,role:k,outletId:"MANAGER"===k?S:void 0})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Invite failed")}let l=await t.json(),s=window.location.origin,r=l.invite_token?"".concat(s,"/accept-invite?token=").concat(encodeURIComponent(l.invite_token)):"";j("Invitation created for ".concat(a,". Share the link below with them.")),N(r||null),w(""),A("CASHIER"),C(""),await $()}catch(e){f(e instanceof Error?e.message:"Invite failed")}finally{O(!1)}},[e.token,y,k,S,$]),el=(0,s.useCallback)(async t=>{t.preventDefault(),f(null),z(null);let a=I.trim();if(!a||!M)return void f("Email and password are required.");if("MANAGER"===q&&!D)return void f("Outlet is required for Manager role.");B(!0);try{let t=await fetch("".concat(i,"/staff/users"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)},body:JSON.stringify({email:a,password:M,name:P.trim()||void 0,role:q,outletId:"MANAGER"===q?D:void 0})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Add user failed")}z("User added. They can sign in with that email and password."),R(""),_(""),T(""),F("CASHIER"),G(""),await $()}catch(e){f(e instanceof Error?e.message:"Add user failed")}finally{B(!1)}},[e.token,I,M,P,q,D,$]),es=(0,s.useCallback)(async t=>{if(t.preventDefault(),f(null),V(null),!H.trim())return void f("Outlet name is required.");K(!0);try{let t=await fetch("".concat(i,"/outlets"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)},body:JSON.stringify({name:H.trim(),address:W.trim()||void 0})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Add outlet failed")}V("Outlet created."),U(""),X(""),await $()}catch(e){f(e instanceof Error?e.message:"Add outlet failed")}finally{K(!1)}},[e.token,H,W,$]);return e.token?Z?(0,l.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,l.jsx)("header",{className:"border-b border-slate-600 pb-4",children:(0,l.jsx)("h1",{className:"text-2xl font-bold text-slate-100",children:"Staff & Outlet Access"})}),p&&(0,l.jsx)("div",{className:"rounded-lg bg-red-500/15 border border-red-500/30 px-4 py-2 text-sm text-red-400",children:p}),g&&(0,l.jsxs)("div",{className:"rounded-lg bg-emerald-500/15 border border-emerald-500/30 px-4 py-2 text-sm text-emerald-400 space-y-2",children:[(0,l.jsx)("p",{children:g}),v&&(0,l.jsx)("input",{type:"text",readOnly:!0,value:v,className:"w-full rounded bg-slate-800/80 border border-slate-600 px-2 py-1.5 text-slate-300 text-xs font-mono",onFocus:e=>e.target.select()})]}),L&&(0,l.jsx)("div",{className:"rounded-lg bg-emerald-500/15 border border-emerald-500/30 px-4 py-2 text-sm text-emerald-400",children:L}),Q&&(0,l.jsx)("div",{className:"rounded-lg bg-emerald-500/15 border border-emerald-500/30 px-4 py-2 text-sm text-emerald-400",children:Q}),(0,l.jsxs)("section",{className:"rounded-xl bg-slate-800/50 border border-slate-700 p-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Add outlet"}),(0,l.jsx)("p",{className:"text-slate-400 text-sm mb-4",children:"Create a new outlet (e.g. a second location). You can then assign staff to it below."}),(0,l.jsxs)("form",{onSubmit:es,className:"flex flex-wrap items-end gap-3 max-w-md",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"outlet-name",className:"block text-sm font-medium text-slate-300 mb-1",children:"Name *"}),(0,l.jsx)("input",{id:"outlet-name",type:"text",value:H,onChange:e=>U(e.target.value),placeholder:"e.g. Downtown Store",className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200 placeholder:text-slate-500",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"outlet-address",className:"block text-sm font-medium text-slate-300 mb-1",children:"Address (optional)"}),(0,l.jsx)("input",{id:"outlet-address",type:"text",value:W,onChange:e=>X(e.target.value),placeholder:"123 Main St",className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200 placeholder:text-slate-500"})]}),(0,l.jsx)("button",{type:"submit",disabled:Y,className:"rounded-lg bg-sky-600 px-4 py-2 text-sm font-medium text-white hover:bg-sky-500 disabled:opacity-50",children:Y?"Creating…":"Add outlet"})]})]}),(0,l.jsxs)("section",{className:"rounded-xl bg-slate-800/50 border border-slate-700 p-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Invite staff (by email)"}),(0,l.jsx)("p",{className:"text-slate-400 text-sm mb-4",children:"Send an invitation by email. Choose a role: Admin (full access), Manager (single outlet), or Cashier. After they accept, assign Cashiers to outlets below."}),(0,l.jsxs)("form",{onSubmit:ea,className:"space-y-4 max-w-md",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"invite-email",className:"block text-sm font-medium text-slate-300 mb-1",children:"Email address *"}),(0,l.jsx)("input",{id:"invite-email",type:"email",value:y,onChange:e=>w(e.target.value),placeholder:"staff@example.com",className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200 placeholder:text-slate-500",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"invite-role",className:"block text-sm font-medium text-slate-300 mb-1",children:"Role *"}),(0,l.jsxs)("select",{id:"invite-role",value:k,onChange:e=>A(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200",children:[(0,l.jsx)("option",{value:"CASHIER",children:"Cashier"}),(0,l.jsx)("option",{value:"MANAGER",children:"Manager"}),(0,l.jsx)("option",{value:"ADMIN",children:"Admin"})]}),(0,l.jsx)("p",{className:"text-slate-500 text-xs mt-1",children:"Cashier: POS and sessions. Manager: one outlet. Admin: all outlets and settings."})]}),"MANAGER"===k&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"invite-outlet",className:"block text-sm font-medium text-slate-300 mb-1",children:"Outlet (required for Manager) *"}),(0,l.jsxs)("select",{id:"invite-outlet",value:S,onChange:e=>C(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200",required:"MANAGER"===k,children:[(0,l.jsx)("option",{value:"",children:"Select outlet"}),c.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,l.jsx)("button",{type:"submit",disabled:E,className:"rounded-lg bg-sky-600 px-4 py-2 text-sm font-medium text-white hover:bg-sky-500 disabled:opacity-50",children:E?"Sending…":"Send invitation"})]})]}),(0,l.jsxs)("section",{className:"rounded-xl bg-slate-800/50 border border-slate-700 p-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Add user (email + password)"}),(0,l.jsx)("p",{className:"text-slate-400 text-sm mb-4",children:"Create a user account directly with email and password. They can sign in immediately. For Manager, pick an outlet."}),(0,l.jsxs)("form",{onSubmit:el,className:"space-y-4 max-w-md",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"add-user-email",className:"block text-sm font-medium text-slate-300 mb-1",children:"Email *"}),(0,l.jsx)("input",{id:"add-user-email",type:"email",value:I,onChange:e=>R(e.target.value),placeholder:"user@example.com",className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200 placeholder:text-slate-500",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"add-user-password",className:"block text-sm font-medium text-slate-300 mb-1",children:"Password *"}),(0,l.jsx)("input",{id:"add-user-password",type:"password",value:M,onChange:e=>_(e.target.value),placeholder:"••••••••",className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200 placeholder:text-slate-500",required:!0,minLength:6})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"add-user-name",className:"block text-sm font-medium text-slate-300 mb-1",children:"Name (optional)"}),(0,l.jsx)("input",{id:"add-user-name",type:"text",value:P,onChange:e=>T(e.target.value),placeholder:"Display name",className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200 placeholder:text-slate-500"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"add-user-role",className:"block text-sm font-medium text-slate-300 mb-1",children:"Role *"}),(0,l.jsxs)("select",{id:"add-user-role",value:q,onChange:e=>F(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200",children:[(0,l.jsx)("option",{value:"CASHIER",children:"Cashier"}),(0,l.jsx)("option",{value:"MANAGER",children:"Manager"}),(0,l.jsx)("option",{value:"ADMIN",children:"Admin"})]})]}),"MANAGER"===q&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"add-user-outlet",className:"block text-sm font-medium text-slate-300 mb-1",children:"Outlet (required for Manager) *"}),(0,l.jsxs)("select",{id:"add-user-outlet",value:D,onChange:e=>G(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200",required:"MANAGER"===q,children:[(0,l.jsx)("option",{value:"",children:"Select outlet"}),c.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,l.jsx)("button",{type:"submit",disabled:J,className:"rounded-lg bg-sky-600 px-4 py-2 text-sm font-medium text-white hover:bg-sky-500 disabled:opacity-50",children:J?"Adding…":"Add user"})]})]}),(0,l.jsxs)("section",{className:"rounded-xl bg-slate-800/50 border border-slate-700 p-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Team members"}),(0,l.jsx)("ul",{className:"space-y-2",children:t.map(e=>(0,l.jsxs)("li",{className:"flex items-center justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-slate-300",children:e.email}),(0,l.jsx)("span",{className:"text-slate-500",children:e.role})]},e.id))})]}),(0,l.jsxs)("section",{className:"rounded-xl bg-slate-800/50 border border-slate-700 p-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Pending invitations"}),(0,l.jsxs)("ul",{className:"space-y-2",children:[r.map(e=>(0,l.jsxs)("li",{className:"flex items-center justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-slate-300",children:e.email}),(0,l.jsx)("span",{className:"text-slate-500",children:e.role})]},e.id)),0===r.length&&(0,l.jsx)("p",{className:"text-slate-500 text-sm",children:"No pending invitations."})]})]}),(0,l.jsxs)("section",{className:"rounded-xl bg-slate-800/50 border border-slate-700 p-4",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Outlet access"}),(0,l.jsx)("p",{className:"text-slate-400 text-sm mb-4",children:"Assign team members to outlets. Owner and Admin have access to all outlets."}),(0,l.jsx)("div",{className:"space-y-4",children:c.map(e=>{var a;return(0,l.jsxs)("div",{className:"border border-slate-600 rounded-lg p-3",children:[(0,l.jsx)("h3",{className:"font-medium text-slate-200 mb-2",children:e.name}),(0,l.jsx)("ul",{className:"space-y-1 mb-3",children:(null!=(a=m[e.id])?a:[]).map(t=>(0,l.jsxs)("li",{className:"flex items-center justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-slate-300",children:t.email}),(0,l.jsx)("button",{type:"button",onClick:()=>et(e.id,t.user_id),disabled:null!==h,className:"text-red-400 hover:underline text-xs disabled:opacity-50",children:"Remove"})]},t.user_id))}),(0,l.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,l.jsx)("span",{className:"text-slate-500 text-sm",children:"Add:"}),t.filter(e=>"OWNER"!==e.role&&"ADMIN"!==e.role).filter(t=>{var a;return!(null!=(a=m[e.id])?a:[]).some(e=>e.user_id===t.user_id)}).map(t=>(0,l.jsx)("button",{type:"button",onClick:()=>ee(e.id,t.user_id),disabled:null!==h,className:"rounded bg-sky-600 px-2 py-1 text-xs text-white hover:bg-sky-500 disabled:opacity-50",children:t.email},t.user_id))]})]},e.id)})})]})]}):(0,l.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,l.jsx)("p",{className:"text-slate-400",children:"Only Owner or Admin can access this page."})}):(0,l.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,l.jsx)("p",{className:"text-slate-400",children:"Sign in to manage staff."}),(0,l.jsx)(n(),{href:"/login",className:"text-sky-400 hover:underline mt-2 inline-block",children:"Sign in"})]})}},3042:(e,t,a)=>{Promise.resolve().then(a.bind(a,2206))},5380:(e,t,a)=>{"use strict";a.d(t,{A:()=>u,AuthProvider:()=>c,c:()=>m});var l=a(5155),s=a(2115);let r=a(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3001",n="bluecounts_auth",o={user:null,tenant:null,role:"",outletId:null,token:null},i=(0,s.createContext)(null);function d(e){e.token&&e.tenant?localStorage.setItem(n,JSON.stringify(e)):localStorage.removeItem(n)}function c(e){let{children:t}=e,[a,c]=(0,s.useState)(o);(0,s.useEffect)(()=>{c(function(){try{var e,t,a,l,s;let r=localStorage.getItem(n);if(!r)return o;let i=JSON.parse(r);if((null==i?void 0:i.token)&&(null==i||null==(e=i.tenant)?void 0:e.id))return{user:null!=(t=i.user)?t:null,tenant:null!=(a=i.tenant)?a:null,role:null!=(l=i.role)?l:"",outletId:null!=(s=i.outletId)?s:null,token:i.token}}catch(e){}return o}())},[]);let u=(0,s.useCallback)(e=>{c(e),d(e)},[]),m=(0,s.useCallback)(async(e,t)=>{var a;let l=await fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!l.ok)throw Error((await l.json().catch(()=>({}))).error||"Login failed");let s=await l.json();u({user:s.user,tenant:s.tenant,role:s.role,outletId:null!=(a=s.outletId)?a:null,token:s.token})},[u]),x=(0,s.useCallback)(async(e,t,a)=>{let l=await fetch("".concat(r,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,businessName:a})});if(!l.ok)throw Error((await l.json().catch(()=>({}))).error||"Registration failed");let s=await l.json();u({user:s.user,tenant:s.tenant,role:s.role,outletId:null,token:s.token})},[u]),h=(0,s.useCallback)(()=>{u(o)},[u]),b=(0,s.useCallback)(e=>{c(t=>{let a={...t,outletId:e};return d(a),a})},[]);return(0,l.jsx)(i.Provider,{value:{...a,login:m,register:x,logout:h,setOutletId:b,setAuth:u},children:t})}function u(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}function m(){try{var e;let t=localStorage.getItem(n);if(!t)return null;let a=JSON.parse(t);return null!=(e=null==a?void 0:a.token)?e:null}catch(e){return null}}}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=3042)),_N_E=e.O()}]);