(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[445],{5156:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(5155),s=r(8841),l=r(2115),a=r(2619),u=r.n(a),i=r(7138),o=r(5380),d=r(9058);let c="bluecounts_device_id";function m(){var e,t,r;let a,m=(0,o.A)(),b=null!=(t=null==(e=m.tenant)?void 0:e.id)?t:"",x=null!=(r=m.outletId)?r:"",h=((a=localStorage.getItem(c))||(a=crypto.randomUUID(),localStorage.setItem(c,a)),a),[p,f]=(0,l.useState)(""),[v,y]=(0,l.useState)(""),[g,j]=(0,l.useState)(null);(0,d.a)({tenantId:b,outletId:x,deviceId:h,enabled:!!b&&!!x});let N=(0,s.kk)(()=>i.db.products.where("tenant_id").equals(b).filter(e=>null==e.deleted_at).toArray(),[b]),w=(0,s.kk)(()=>i.db.inventory.where("[tenant_id+outlet_id]").equals([b,x]).filter(e=>null==e.deleted_at).toArray(),[b,x]),_=(0,l.useCallback)(e=>{var t,r;let n=null!=(t=null==w?void 0:w.filter(t=>t.product_id===e))?t:[],s=0===n.length?null:n.reduce((e,t)=>e.version_id>t.version_id?e:t);return null!=(r=null==s?void 0:s.quantity)?r:0},[w]),k=(0,l.useCallback)(async e=>{e.preventDefault(),j(null);let t=parseInt(v,10);if(!p||Number.isNaN(t)||0===t)return void j("Select a product and enter a non-zero quantity change.");await i.db.sync_queue.add({id:crypto.randomUUID(),action_type:"ADJUST_STOCK",payload:{product_id:p,quantity_change:t},timestamp:Date.now(),status:"pending"}),y(""),f(""),j("Adjustment queued. It will sync when online.")},[p,v]);if(!m.token)return(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,n.jsx)("p",{className:"text-slate-400",children:"Sign in to manage inventory."}),(0,n.jsx)(u(),{href:"/login",className:"text-sky-400 hover:underline mt-2 inline-block",children:"Sign in"})]});if(!x)return(0,n.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,n.jsx)("p",{className:"text-slate-400",children:"Select an outlet in the sidebar to view and adjust inventory."})});let S=null!=N?N:[],q=S.map(e=>({product:e,quantity:_(e.id)}));return(0,n.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,n.jsx)("header",{className:"border-b border-slate-600 pb-4",children:(0,n.jsx)("h1",{className:"text-2xl font-bold text-slate-100",children:"Inventory"})}),g&&(0,n.jsx)("div",{className:"rounded-lg bg-sky-500/15 border border-sky-500/30 px-4 py-2 text-sm text-sky-400",children:g}),(0,n.jsxs)("section",{className:"rounded-xl bg-slate-800/50 border border-slate-700 p-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Adjust stock"}),(0,n.jsx)("p",{className:"text-slate-400 text-sm mb-4",children:"Changes are queued and synced when online. Use a positive value to add, negative to remove."}),(0,n.jsxs)("form",{onSubmit:k,className:"flex flex-wrap items-end gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"product",className:"block text-sm text-slate-400 mb-1",children:"Product"}),(0,n.jsxs)("select",{id:"product",value:p,onChange:e=>f(e.target.value),className:"rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200",children:[(0,n.jsx)("option",{value:"",children:"Select"}),S.map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.name," (current: ",_(e.id),")"]},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"qty_change",className:"block text-sm text-slate-400 mb-1",children:"Quantity change"}),(0,n.jsx)("input",{id:"qty_change",type:"number",value:v,onChange:e=>y(e.target.value),placeholder:"+10 or -5",className:"rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-200 w-32"})]}),(0,n.jsx)("button",{type:"submit",className:"rounded-lg bg-amber-600 px-4 py-2 text-sm font-medium text-white hover:bg-amber-500",children:"Apply"})]})]}),(0,n.jsxs)("section",{className:"rounded-xl bg-slate-800/50 border border-slate-700 p-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Current stock"}),(0,n.jsxs)("ul",{className:"space-y-2",children:[q.map(e=>{let{product:t,quantity:r}=e;return(0,n.jsxs)("li",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-slate-300",children:t.name}),(0,n.jsx)("span",{className:"text-slate-200 font-medium",children:r})]},t.id)}),0===q.length&&(0,n.jsx)("p",{className:"text-slate-500 text-sm",children:"No products for this outlet."})]})]})]})}},5796:(e,t,r)=>{Promise.resolve().then(r.bind(r,5156))},8841:(e,t,r)=>{"use strict";r.d(t,{kk:()=>l});var n=r(3278),s=r(2115);function l(e,t,r){return function(e,t,r){"function"==typeof e?(n=t||[],l=r):(n=[],l=t);var n,l,a=s.useRef({hasResult:!1,result:l,error:null}),u=s.useReducer(function(e){return e+1},0);u[0];var i=u[1],o=s.useMemo(function(){var t="function"==typeof e?e():e;if(!t||"function"!=typeof t.subscribe)if(e===t)throw TypeError("Given argument to useObservable() was neither a valid observable nor a function.");else throw TypeError("Observable factory given to useObservable() did not return a valid observable.");if(!a.current.hasResult&&"undefined"!=typeof window&&("function"!=typeof t.hasValue||t.hasValue()))if("function"==typeof t.getValue)a.current.result=t.getValue(),a.current.hasResult=!0;else{var r=t.subscribe(function(e){a.current.result=e,a.current.hasResult=!0});"function"==typeof r?r():r.unsubscribe()}return t},n);if(s.useDebugValue(a.current.result),s.useEffect(function(){var e=o.subscribe(function(e){var t=a.current;(null!==t.error||t.result!==e)&&(t.error=null,t.result=e,t.hasResult=!0,i())},function(e){var t=a.current;t.error!==e&&(t.error=e,i())});return"function"==typeof e?e:e.unsubscribe.bind(e)},n),a.current.error)throw a.current.error;return a.current.result}(function(){return(0,n.Dd)(e)},t||[],r)}}},e=>{e.O(0,[619,278,58,441,255,358],()=>e(e.s=5796)),_N_E=e.O()}]);