(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[454],{63:(e,t,l)=>{"use strict";var a=l(7260);l.o(a,"usePathname")&&l.d(t,{usePathname:function(){return a.usePathname}}),l.o(a,"useRouter")&&l.d(t,{useRouter:function(){return a.useRouter}}),l.o(a,"useSearchParams")&&l.d(t,{useSearchParams:function(){return a.useSearchParams}})},1957:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>i});var a=l(5155),n=l(2115),r=l(63),s=l(2619),u=l.n(s),o=l(5380);function i(){let e=(0,r.useRouter)(),{register:t}=(0,o.A)(),[l,s]=(0,n.useState)(""),[i,c]=(0,n.useState)(""),[d,h]=(0,n.useState)(""),[m,x]=(0,n.useState)(""),[b,f]=(0,n.useState)(!1);async function g(a){a.preventDefault(),x(""),f(!0);try{await t(l,i,d),e.push("/")}catch(e){x(e instanceof Error?e.message:"Registration failed")}finally{f(!1)}}return(0,a.jsx)("main",{className:"min-h-screen flex items-center justify-center p-4 bg-slate-900",children:(0,a.jsxs)("div",{className:"w-full max-w-sm rounded-xl bg-slate-800 border border-slate-700 p-6",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-slate-100 mb-4",children:"Register your business"}),(0,a.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Business name"}),(0,a.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-100",placeholder:"Acme Inc",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:l,onChange:e=>s(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-100",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",value:i,onChange:e=>c(e.target.value),className:"w-full rounded-lg bg-slate-700 border border-slate-600 px-3 py-2 text-slate-100",required:!0,minLength:6})]}),m&&(0,a.jsx)("p",{className:"text-sm text-red-400",children:m}),(0,a.jsx)("button",{type:"submit",disabled:b,className:"w-full rounded-lg bg-sky-600 px-4 py-2 text-white font-medium hover:bg-sky-500 disabled:opacity-50",children:b?"Creatingâ€¦":"Create business"})]}),(0,a.jsxs)("p",{className:"mt-4 text-sm text-slate-500",children:["Already have an account? ",(0,a.jsx)(u(),{href:"/login",className:"text-sky-400 hover:underline",children:"Sign in"})]})]})})}},5380:(e,t,l)=>{"use strict";l.d(t,{A:()=>d,AuthProvider:()=>c,c:()=>h});var a=l(5155),n=l(2115);let r=l(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3001",s="bluecounts_auth",u={user:null,tenant:null,role:"",outletId:null,token:null},o=(0,n.createContext)(null);function i(e){e.token&&e.tenant?localStorage.setItem(s,JSON.stringify(e)):localStorage.removeItem(s)}function c(e){let{children:t}=e,[l,c]=(0,n.useState)(u);(0,n.useEffect)(()=>{c(function(){try{var e,t,l,a,n;let r=localStorage.getItem(s);if(!r)return u;let o=JSON.parse(r);if((null==o?void 0:o.token)&&(null==o||null==(e=o.tenant)?void 0:e.id))return{user:null!=(t=o.user)?t:null,tenant:null!=(l=o.tenant)?l:null,role:null!=(a=o.role)?a:"",outletId:null!=(n=o.outletId)?n:null,token:o.token}}catch(e){}return u}())},[]);let d=(0,n.useCallback)(e=>{c(e),i(e)},[]),h=(0,n.useCallback)(async(e,t)=>{var l;let a=await fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!a.ok)throw Error((await a.json().catch(()=>({}))).error||"Login failed");let n=await a.json();d({user:n.user,tenant:n.tenant,role:n.role,outletId:null!=(l=n.outletId)?l:null,token:n.token})},[d]),m=(0,n.useCallback)(async(e,t,l)=>{let a=await fetch("".concat(r,"/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,businessName:l})});if(!a.ok)throw Error((await a.json().catch(()=>({}))).error||"Registration failed");let n=await a.json();d({user:n.user,tenant:n.tenant,role:n.role,outletId:null,token:n.token})},[d]),x=(0,n.useCallback)(()=>{d(u)},[d]),b=(0,n.useCallback)(e=>{c(t=>{let l={...t,outletId:e};return i(l),l})},[]);return(0,a.jsx)(o.Provider,{value:{...l,login:h,register:m,logout:x,setOutletId:b,setAuth:d},children:t})}function d(){let e=(0,n.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}function h(){try{var e;let t=localStorage.getItem(s);if(!t)return null;let l=JSON.parse(t);return null!=(e=null==l?void 0:l.token)?e:null}catch(e){return null}}},8813:(e,t,l)=>{Promise.resolve().then(l.bind(l,1957))}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=8813)),_N_E=e.O()}]);